import sqlite3

class Request:
    def __init__(self, database_path, sql_request):
        self.database_path = database_path
        self.sql_request = sql_request
        # self.make_request()


    def make_request(self):
        """
        Pas encore de placeholders pour gérer séparément la requête et les paramètres...
        À implémenter
        :return: None
        """
        result_list = []

        try:
            # Pour déconnecter automatiquement, même en cas d'erreur...
            with sqlite3.connect(self.database_path) as connexion:
                curseur = connexion.cursor()

                # Activer PRAGMA pour cette connexion pour activer la sensibilité à la casse
                curseur.execute("PRAGMA case_sensitive_like = ON;")

                # Exécuter la requête PRAGMA pour voir l'état de la sensibilité à la casse
                # Pas réussi à voit la valeur de curseur.fetchone()[0]...
                # curseur.execute("PRAGMA case_sensitive_like;")
                # resultat = curseur.fetchone()[0]
                #
                # # Afficher le résultat
                # if resultat:
                #     print(f"Résultat de PRAGMA case_sensitive_like : {resultat}")
                # else:
                #     print("Impossible de récupérer le résultat de PRAGMA.")

                # Exécuter la requête SQL
                curseur.execute(self.sql_request)
                resultats = curseur.fetchall()
                i = 1
                if resultats:
                    for ligne in resultats:
                        print(ligne[0])
                        result_list.append((i, ligne[0]))
                        i += 1
                    print(f"Il y a {len(resultats)} résultats.")
                else:
                    print("Aucun résultat trouvé.")


        except sqlite3.Error as erreur:
            print(f"Erreur SQLite3 : {erreur}")

        except Exception as erreur:
            print(f"Une erreur inattendue s'est produite : {erreur}")

        # Renvoyer la liste des mots trouvés
        return result_list


# Fonction pour permettre à SQLite3 de faire de recherches sensibles à la casse
def query_pragma(database_path):
    try:
        # Pour déconnecter automatiquement, même en cas d'erreur...
        with sqlite3.connect(database_path) as connexion:
            curseur = connexion.cursor()
            curseur.execute("PRAGMA case_sensitive_like = ON;")

            print(f"PRAGMA configuré --> SQLite3 sensible à la casse.")

    except sqlite3.Error as erreur:
        print(f"Erreur SQLite3 : {erreur}")

    except Exception as erreur:
        print(f"Impossible de configurer Pragma : {erreur}")
